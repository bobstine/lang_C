/*	--------------------  Plot Windows  -----------------			8 Apr 88 ... Add better scaling.	7 Apr 88 ... Created to support the kernel estimation routines.	*/#include <stdio.h>#include "InOut.h"#include "PlotWindow.h"#include "MacProto.h"/*  ------------------------  PROTOTS  -----------------------------  */#ifdef PROTO	int printf(...);	void InitForPlot(void);	void SetMinMax(MATRIX *data);	void DrawMatrix (MATRIX *data, int connect);	int MapX(double x);	int MapY(double y);	void WaitForMouse(void);#endif/*  ------------------------  DEFINES  -----------------------------  */#define MARGINPCT  0.05/*  ------------------------  GLOBALS  -----------------------------  */static WindowPtr	currWindow;static Rect	  	windowRect = {50, 0, 250, 200}; /* top, left, bottom, right */static Rect 	symbol = {0, 0, 2, 2};static int 		needToInit = 1;static double 	xMin, xMax, yMin, yMax, xRange, yRange, xScale, yScale;/*  ----------------------------------------------------------------  */static void InitForPlot(){#ifdef LSC#else	InitGraf (&thePort);		/* do not do this if using LSC with stdio!! */	InitFonts ();	InitWindows ();	InitCursor ();#endif	needToInit = 0;}static void SetMinMax(data)MATRIX *data;{	int i,j;	double test, margin;		for (i=0; i<data->nRows; ++i)	{	test = data->pntr[0][i];		if ( test< xMin)			xMin = test;		else if (test > xMax)			xMax = test;		for (j=1; j<data->nCols; ++j)		{	test = data->pntr[j][i];			if (test<yMin)				yMin = test;			else if (test>yMax)				yMax = test;		}	}	margin = MARGINPCT * (xMax - xMin);	xMin -= margin;	xMax += margin;	xRange = xMax - xMin;	xScale = (double)(windowRect.right-windowRect.left) / xRange;	margin = MARGINPCT * (yMax - yMin);	yMin -= margin;	yMax += margin;	yRange = yMax - yMin;	yScale = (double)(windowRect.bottom-windowRect.top) / yRange;	printf ("xRange [%f,%f] is %f with scale of %f\n", xMin, xMax, xRange, xScale);}int MapX(x)double x;{	return ((int) xScale*(x-xMin));}int MapY(y)double y;{	return ((int) yScale*(yMax - y));}		static void DrawMatrix (data, connect)MATRIX *data;int connect;{	PenState *oldPen;	Rect	symbol;	double *xCol, *yCol;	int i,map;		xCol = data->pntr[0];	yCol = data->pntr[1];	GetPenState (oldPen);	PenNormal();	if (connect)	{	MoveTo ( MapX(xCol[0]), MapY(yCol[0]) );		for (i=1; i<data->nRows; ++i)		 	LineTo (MapX(xCol[i]), MapY(yCol[i]));	}	else	{	for (i=0; i<data->nRows; ++i)		{	SetOrigin ( MapX(xCol[i]), MapY(yCol[i]) );			PaintRect (&symbol);		}	}	SetPenState(oldPen);	}	static void WaitForMouse(){	EventRecord theEvent;	WindowPtr whichWindow;	while (1)	{	GetNextEvent (everyEvent, &theEvent);		if (theEvent.what == mouseDown)			return;	}	}void pwSetPlotWindowSize(h, v)int h,v;{	windowRect.bottom = windowRect.top + v;	windowRect.right = windowRect.left + h;}void pwSetPlotWindowLoc (h, v)int h,v;{	int hSize, vSize;		hSize = windowRect.right - windowRect.left;	vSize = windowRect.bottom - windowRect.top;	windowRect.top = v;	windowRect.bottom = v + vSize;	windowRect.left = h;	windowRect.right = h + hSize;}void pwCreatePlotWindow (data, aWindow)MATRIX *data;WindowPtr *aWindow;{	GrafPtr oldPort;		if (needToInit)		InitForPlot();	GetPort (&oldPort);	(*aWindow) = NewWindow ((Ptr)0, &windowRect, "\pPlot Window", (Boolean)1, 0, (WindowPtr)-1, (Boolean)1, (long)0);	SetPort (*aWindow);	MoveTo (0,0);	PenNormal();	LineTo (windowRect.right,windowRect.bottom);	WaitForMouse();	SetPort (oldPort);	xMin=1.0e100;  xMax=-xMin;	yMin=1.0e100;  yMax=-yMin;}	void pwPlotData (MATRIX *data);	void pwPlotData (data)MATRIX *data;{	GrafPtr oldPort;	int i;		GetPort (&oldPort);	/* SelectWindow (aWindow); */	/* SetPort (theWindow); */		SetMinMax(data);	DrawMatrix(data, 1);	WaitForMouse();	SetPort (oldPort);}void pwAddToPlot (MATRIX *data);	void pwAddToPlot (data)MATRIX *data;{	GrafPtr oldPort;	int i;		GetPort (&oldPort);	/* SelectWindow (theWindow); */	/* SetPort (theWindow); */		DrawMatrix(data, 1);	WaitForMouse();	SetPort (oldPort);}