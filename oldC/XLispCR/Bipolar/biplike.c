#include <math.h>#include <stdlib.h>// Prototypesvoid BipolarLogLike(long *y, double *s, long *n, double *alpha, double *beta, double *ll);// Local prototypesstatic void BuildBiCoefTable (long n);// Internal globalsstatic double **biCoef;static long  biCoefLen = 0;// Subroutinesstatic void BuildBiCoefTable (long n){	long i,j;	double *pBC;		biCoefLen = n;	biCoef = (double **) malloc((1+biCoefLen) * sizeof(double *));  // Allocate table	for(i=0; i<=biCoefLen; ++i)		biCoef[i] = (double *) malloc((i+1) * sizeof(double));			*biCoef[0] = 1.0;												// Fill table	for (i=1; i<=biCoefLen; ++i)	{	*biCoef[i] = 1.0;		pBC = biCoef[i];		++pBC;		for (j=1; j < i; ++j)		 	*pBC++ = biCoef[i-1][j-1] + biCoef[i-1][j];		*pBC = 1.0;	}}#define BinomialCoef(n,k) biCoef[n][k]#define TOOSMALL .00000001void BipolarLogLike(long *y, double *s, long *n, double *alpha, double *beta, double *ll){	long i, j;	double b, accum, sTerm, aTerm, bTerm, dN;		if (biCoefLen == 0)		BuildBiCoefTable(40);	b = *beta/(1+*beta);	dN = (double) *n;	*ll = 0.0;	for (i=0; i<*n; ++i)	{	if (*s <= TOOSMALL)		// smth term is zero or negative		{	aTerm = *alpha;			accum = 1.0;			for(j=0; j<*y; ++j)			{	accum *= b * aTerm;				aTerm += 1.0;			}			*ll += log(accum);		}		else					// usual case		{	sTerm = 1.0;			for (j=0; j< *y; ++j) 				sTerm *= *s;			bTerm = 1.0;			aTerm = 1.0;			accum = 0.0;			for (j=0; j<=*y; ++j)			{	accum += BinomialCoef(*y,j) * sTerm * bTerm * aTerm;				sTerm /= *s;				aTerm *= (*alpha)+j;				bTerm *= b;			}			*ll += log(accum) - *s;		}		++s;					// increment list pointers		++y;	}	*ll -= dN * (*alpha) * log(1.0 + *beta);}