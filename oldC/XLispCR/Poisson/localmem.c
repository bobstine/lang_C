/*	 3 Jun 94 ... Memory marks and use of malloc.	23 May 94 ... Created to manage memory from XLisp code resource.*/#include <stdlib.h>#include "localmem.h"/* -------------------------------------		Globals   ------------------------------------- */static long LOCAL_MEMORY_SIZE;static long LOCAL_MEMORY_AVAIL;static char *LOCAL_MEMORY_BASE;static char *LOCAL_MEMORY_PTR;static char *LOCAL_MEMORY_MARK;static long  LOCAL_MEMORY_MARK_AVAIL;   _static_	void InitLocalMemory (long nBytes){	void *ptr;	ptr = malloc(nBytes);	if (ptr == NULL) nBytes = 0;		LOCAL_MEMORY_SIZE = nBytes;	LOCAL_MEMORY_AVAIL= nBytes;	LOCAL_MEMORY_PTR  = (char *) ptr;		/* init pointers to memory base */	LOCAL_MEMORY_BASE = (char *) ptr;	LOCAL_MEMORY_MARK = (char *) ptr;	LOCAL_MEMORY_MARK_AVAIL = LOCAL_MEMORY_SIZE;}_static_	void MarkMemory(){	LOCAL_MEMORY_MARK_AVAIL = LOCAL_MEMORY_AVAIL;	LOCAL_MEMORY_MARK       = LOCAL_MEMORY_PTR;}_static_	void FreeMemoryToMark (){	LOCAL_MEMORY_AVAIL = LOCAL_MEMORY_MARK_AVAIL;	LOCAL_MEMORY_PTR   = LOCAL_MEMORY_MARK;}_static_	long AvailableLocalMemory (){	return(LOCAL_MEMORY_AVAIL);}_static_	void FreeLocalMemory (){	free( (void *) LOCAL_MEMORY_BASE);}//	Aligns arg to multiple of 8 (other factors obtained by altering mask)	#define Align(i) i+=((~i)+1)&0x0007_static_	void *LocalMalloc(long nBytes){	void *p;		Align(nBytes);						// Force multiple of 8	if (nBytes <= LOCAL_MEMORY_AVAIL)	{	p = LOCAL_MEMORY_PTR;		LOCAL_MEMORY_PTR += nBytes;		LOCAL_MEMORY_AVAIL -= nBytes;	} else	{	p = NULL;	}	return(p);}