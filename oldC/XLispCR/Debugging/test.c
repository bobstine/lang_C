/* Test passing ints and reals to XLisp */#include "xlsx.h"static void PutAddrInA1 (void);static void test   	(XLSXblock *parms);static void sum   	(XLSXblock *parms);/*  _________________  Function called from XLisp  ________________________ */main(parms)XLSXblock *parms;{	long *code;		asm {	LEA main, A0	}		/* why not just push A4, LEA into a4? */	PutAddrInA1();					/*	get stack-based location	*/	asm {	move.l a0,(a1)	}  		/*  save A0 into this location	*/	asm {	move.l a4,-(sp) };		/*	push a4 onto stack			*/										/*		PutAddrInA1();			*/	asm {	move.l (a1),a4	};		/*  move local addr to a4		*/	code = (long *) XLSXargv(parms,0);	switch (*code)	{	case 0: sum (parms);				break;		default:(*code) = -999;	}	asm { move.l (sp)+,a4 }			/*	Restore A4 from stack		*/}void test (parms)XLSXblock *parms;{	long *pCode;	long *vInt;	double *vX;			pCode = (long *)   XLSXargv(parms,0);	vInt  = (long *)   XLSXargv(parms,1);	vX    = (double *) XLSXargv(parms,2);		*pCode = sizeof(double);	vInt[0] = sizeof (long);	vInt[1] = sizeof (char *);	vInt[2] = sizeof (long *);	vX[0]   = (double) 0.1;	vX[1]   = (double) 1.1;}static double globalSum;static double x1,x2,x3;static void sum (parms)XLSXblock *parms;{	int i;	long n;	double *x, *theSum;		x		= 	(double *) XLSXargv(parms,1);	n		= * (long *)   XLSXargv(parms,2);	theSum	=   (double *) XLSXargv(parms,3);		x1 = x[1];	x2 = x[2];	x3 = x[3];		globalSum = 0.0;	for (i=0; i<n; ++i)		globalSum += x[i];	*theSum = globalSum;}/* --------------  A4 things from <setupA4> ---------------- */static void PutAddrInA1 (void){	asm {		bsr.s	@1			;  pushes return addr on stack		dc.l	0			;  store A4 here@1		move.l	(sp)+,a1    ;  pop stack	}}#define RememberA4()	do { __GetA4(); asm { move.l a4,(a1) } } while (0)#define RememberA0()	do { __GetA4(); asm { move.l a0,(a1) } } while (0)#define SetUpA4()		do { asm { move.l a4,-(sp) } __GetA4(); asm { move.l (a1),a4 } } while (0)#define RestoreA4()		do { asm { move.l (sp)+,a4 } } while (0)		